# 密钥、地址、钱包

## 私钥

私钥是一个256位的随机数，Bicoin使用OS底层的随机数来生成，例如

```python
1E99423A4ED27608A15A2616A2B0E9E52CED330AC530EDCC32C8FFC6A526AEDD
```

## 公钥

通过椭圆曲线算法可以从私钥计算得到公钥，K = k * G，其中k是私钥，G是生成点常数

Bitcoin使用secp256k1标准定义的椭圆曲线和一系列数字常数
$$
y^2 mod p \equiv (x^3 + 7) mod p \\
p = 2^{256} - 2^{32} - 2^9 - 2^8 - 2^7 - 2^6 - 2^4 - 1
$$
将私钥k与G相乘得到公钥K是一个点
$$
K = 1E99423A4ED27608A15A2616A2B0E9E52CED330AC530EDCC32C8FFC6A526AEDD * G \\
K = (x, y) \\
X = F028892BAD7ED57D2FB57BF33081D5CFCF6F9ED3D3D7F159C2E2FFF579DC341A \\
Y = 07CF33DA18BD734C600B96A72BBC4749D5141C90EC8AC328AE52DDFE2E505BDB \\
$$

## 地址

Bitcoin地址由公钥经过SHA256以及RIPEMD160得到，通常用户见到的比特币地址都是经过Base58Check编码得到，例如

```python
1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy

adr = RIPEMD60(SHA256(K))
```

![download7](../../img/download7-1645789584402.jpg)

# 公钥格式

公钥是在椭圆曲线上的一个点(x, y)，通常会加上前缀0x04来表示公钥，例如

```python
K=04F028892BAD7ED57D2FB57BF33081D5CFCF6F9ED3D3D7F159C2E2FFF579DC341A07CF33DA18BD734C600B96A72BBC4749D5141C90EC8AC328AE52DDFE2E505BDB
```

为了将公钥长度缩减，Bitcoin将公钥进行压缩，略去了y点，通过方程已知x点可以求得y点，由于方程左边是y^2，因此y可能有两个解一个为y一个为-y，因此还需要记录y的奇偶性来区分y的正负性，当y为偶数，则使用0x02作为前缀，当y为奇数时，则使用03作为前缀

![img](data:image/png;base64,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)

 

> 假设a是y的一个解，则-a为y的另一个解，-a mod p = -a + p mod p，所以-a+p也是方程的一个解，由于-a + p +a = p，p为素数，那么这两个解其中一个必然是偶数，一定必然是奇数

![download11](../../img/download11.jpg)

## 私钥压缩

由于公钥有两种表示形式，一种为压缩形式，另一种为非压缩形式，因此对应就可能产生两个地址，Bitcoin使用Wallet Import Format(WIF)来解决该问题，WIF通过在私钥后面附加一个后缀01来表示公钥需要压缩，当一个私钥使用WIF压缩格式导出时，其生成的公钥是被压缩过的，当私钥以非WIF压缩格式表示，其生成的公钥是未被压缩过的

![download12](../../img/download12.jpg)